!function(){"use strict";var e="";const t={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__input-error_active"},r=(e,t,r)=>{n(e)?o(t):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=e=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},n=e=>e.some((e=>!e.validity.valid));var a=e+"5c2584faa41177b41691.svg",c=e+"d73f076c46eb5467f5fc.svg",s=e+"40608da7369d39bc1077.svg",d=e+"d3610e9c6dce3cb370d8.svg";document.getElementById("image-pencil").src=a,document.getElementById("white-image-pencil").src=c,document.getElementById("image-plus").src=s,document.getElementById("image-logo").src=d;const i=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}editUserInfo(e){let{name:t,about:r}=e;return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}editProfileAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:this._headers}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}postCard(e){let{caption:t,link:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers,body:JSON.stringify({cardId:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers,body:JSON.stringify({cardId:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}removeLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers,body:JSON.stringify({cardId:e})}).then((e=>e.ok?e.json():Promise.reject(`Error: ${e.status}`)))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"d36a440a-9446-403c-9bd0-1c72d07d3c16","Content-Type":"application/json"}}),l=document.querySelector(".profile__name"),u=document.querySelector(".profile__description"),m=(document.querySelector(".profile__avatar-container"),document.querySelector("#profile-edit-modal")),_=document.querySelector(".profile__edit-btn"),h=document.querySelector(".modal__close-btn--edit-profile"),v=document.querySelector(".modal__submit-btn--edit-profile"),y=document.querySelector(".modal__form--edit-profile"),f=y.querySelector("#name"),p=y.querySelector("#description"),S=document.querySelector(".profile__edit-avatar-btn"),b=document.querySelector("#profile-edit-avatar-modal"),E=document.querySelector("#edit-avatar-modal"),k=E.querySelector("#image-link"),q=document.querySelector(".profile__avatar"),C=document.querySelector(".modal__close-btn--edit-profile-avatar"),L=E.querySelector(".modal__submit-btn--edit-avatar-profile"),g=document.querySelector("#new-post-modal"),x=document.querySelector(".profile__add-btn"),$=document.querySelector(".modal__close-btn--new-post"),j=document.querySelector(".modal__submit-btn--new-post"),U=document.querySelector(".modal__form--new-post"),P=U.querySelector("#image-link"),I=U.querySelector("#post-caption"),w=document.querySelector("#delete-card-modal"),A=document.querySelector(".modal__card-delete-btn"),B=document.querySelector(".modal__card-delete-cancel-btn"),T=document.querySelector(".modal__close-btn--delete-card"),N=document.querySelector("#preview-modal"),O=N.querySelector(".modal__image--preview"),D=N.querySelector(".modal__caption--preview"),J=N.querySelector(".modal__close-btn--preview"),G=document.querySelector(".cards__list");let H,z;function M(e){const t=document.querySelector("#card__template").content.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return r.textContent=e.name,o.src=e.link,o.alt=e.name,e.isLiked&&n.classList.add("card__like-btn_liked"),o.addEventListener("click",(()=>{O.src=e.link,O.alt=e.name,D.textContent=e.name,F(N)})),n.addEventListener("click",(()=>{n.classList.toggle("card__like-btn_liked"),function(e,t){z=t._id,e.classList.contains("card__like-btn_liked")?i.addLike(z).catch((e=>console.error(e))):i.removeLike(z).catch((e=>console.error(e)))}(n,e)})),a.addEventListener("click",(()=>{!function(e,t){H=e,z=t._id,F(w)}(t,e)})),t}function F(e){e.classList.add("modal_opened"),document.addEventListener("keydown",Q)}function K(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",Q)}function Q(e){if("Escape"===e.key){const e=document.querySelector(".modal_opened");e&&K(e)}}i.getUserInfo().then((e=>{l.textContent=e.name,u.textContent=e.about,q.src=e.avatar})).catch((e=>{console.error(e)})),i.getInitialCards().then((e=>e.map((e=>e)))).then((e=>{e.forEach((e=>{const t=M(e);G.append(t)}))})).catch(console.error),_.addEventListener("click",(()=>{F(m),f.value=l.textContent,p.value=u.textContent})),x.addEventListener("click",(()=>F(g))),S.addEventListener("click",(()=>F(b))),h.addEventListener("click",(()=>K(m))),$.addEventListener("click",(()=>K(g))),A.addEventListener("click",(function(){const e=A.textContent;A.textContent="Deleting...",i.removeCard(z).then((()=>{H.remove(),K(w)})).catch((e=>console.error(e))).finally((()=>{A.textContent=e}))})),B.addEventListener("click",(()=>K(w))),T.addEventListener("click",(()=>K(w))),J.addEventListener("click",(()=>K(N))),C.addEventListener("click",(()=>K(b))),y.addEventListener("submit",(function(e){e.preventDefault();const t=v.textContent;v.textContent="Saving...",i.editUserInfo({name:f.value,about:p.value}).then((e=>{l.textContent=e.name,u.textContent=e.about})).catch((e=>console.error(e))).finally((()=>{v.textContent=t})),K(m)})),U.addEventListener("submit",(function(e){e.preventDefault();const t=j.textContent;j.textContent="Saving...",i.postCard({caption:I.value,link:P.value}).then((e=>{const t=M(e);G.prepend(t)})).catch((e=>console.error(e))).finally((()=>{j.textContent=t})),I.value="",P.value="",K(g)})),E.addEventListener("submit",(function(e){console.log("Submit"),e.preventDefault();const t=k.value,r=L.textContent;L.textContent="Saving...",i.editProfileAvatar(t).then((e=>{q.src=e.avatar})).catch((e=>console.error(e))).finally((()=>{L.textContent=r})),K(b)})),document.querySelectorAll(".modal").forEach((e=>{e.addEventListener("click",(t=>{t.target===e&&K(e)}))})),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);r(o,n,t),o.forEach((a=>{a.addEventListener("input",(function(){((e,t,r)=>{t.validity.valid?((e,t,r)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove(r.inputErrorClass),o.classList.remove(r.errorClass),o.textContent=""})(e,t,r):((e,t,r,o)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r,n.classList.add(o.errorClass)})(e,t,t.validationMessage,r)})(e,a,t),r(o,n,t)}))}))})(t,e)}))})(t)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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cCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIl9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7IiwiY29uc3Qgc2V0dGluZ3MgPSB7XG4gICAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICAgIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG5faW5hY3RpdmVcIixcbiAgICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgICBlcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dC1lcnJvcl9hY3RpdmVcIlxuICB9XG5cblxuXG5jb25zdCB0b2dnbGVCdXR0b25TdGF0ZSA9IChpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsc2V0dGluZ3MpID0+IHtcbiAgICAgICAgaWYoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpe1xuICAgICAgICAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQpO1xuICAgICAgICAgICBcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgICB9XG4gfTtcblxuIGNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCkgPT4ge1xuICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuIH07XG5cbiBjb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICAgIH0pO1xuICB9O1xuXG5jb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIHNldHRpbmdzKSA9PiB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QuYWRkKHNldHRpbmdzLmVycm9yQ2xhc3MpO1xuICAgXG4gIH07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIHNldHRpbmdzKSA9PiB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgfTtcblxuXG5jb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCxzZXR0aW5ncykgPT4ge1xuICAgIGlmKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW1lbnQsICBpbnB1dEVsZW1lbnQsIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSwgc2V0dGluZ3MpO1xuXG4gICAgfVxuICAgIGVsc2V7XG4gICAgICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsc2V0dGluZ3MpO1xuICAgIH1cbn07XG5cblxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsc2V0dGluZ3MpID0+e1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2V0dGluZ3MuaW5wdXRTZWxlY3RvcikpO1xuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbigpe1xuICAgICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCxzZXR0aW5ncyk7XG4gICAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCxzZXR0aW5ncyk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuXG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKHNldHRpbmdzKSA9PiB7XG4gIGNvbnN0IGZvcm1MaXN0ID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNldHRpbmdzLmZvcm1TZWxlY3RvcikpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT57XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsc2V0dGluZ3MpO1xuICB9KTtcbn07XG5cblxuY29uc3QgcmVzZXRGb3JtVmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCxzZXR0aW5ncykgPT4ge1xuICAgIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChzZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSk7XG4gICAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3Ioc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICBcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBzZXR0aW5ncyk7XG4gICAgfSk7XG4gIFxuICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgc2V0dGluZ3MpO1xuICB9O1xuXG4gIGV4cG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHNldHRpbmdzIH07IFxuIiwiLy8gdXRpbHMvQXBpLmpzXG5cbmNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gb3B0aW9ucy5iYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgZWRpdFByb2ZpbGVBdmF0YXIoYXZhdGFyKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXZhdGFyOiBhdmF0YXJcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIHBvc3RDYXJkKHsgY2FwdGlvbiwgbGluayB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IGNhcHRpb24sXG4gICAgICAgIGxpbms6IGxpbmssXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cblxuICByZW1vdmVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBjYXJkSWQ6IGNhcmRJZCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZExpa2UoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfS9saWtlc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGNhcmRJZDogY2FyZElkLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICBpZiAocmVzLm9rKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICAgIH0pO1xuICB9XG5cbiAgcmVtb3ZlTGlrZShjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgY2FyZElkOiBjYXJkSWQsXG4gICAgICB9KSxcbiAgICB9KS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIiwiLy8gPT09IFN0eWxlcyBhbmQgVmFsaWRhdGlvbiA9PT1cbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgeyBlbmFibGVWYWxpZGF0aW9uLCBzZXR0aW5ncyB9IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcblxuLy8gPT09IEFQSSBhbmQgQ29uc3RhbnRzID09PVxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5cbi8vID09PSBJbWFnZSBJbXBvcnRzIGFuZCBBc3NpZ25tZW50cyA9PT1cbmltcG9ydCBwZW5jaWxTcmMgZnJvbSBcIi4uL2ltYWdlcy9wZW5jaWwuc3ZnXCI7XG5jb25zdCBwZW5jaWxJbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiaW1hZ2UtcGVuY2lsXCIpO1xucGVuY2lsSW1hZ2Uuc3JjID0gcGVuY2lsU3JjO1xuXG5pbXBvcnQgd2hpdGVQZW5jaWxTcmMgZnJvbSBcIi4uL2ltYWdlcy93aGl0ZS1wZW5jaWwuc3ZnXCI7XG5jb25zdCB3aGl0ZVBlbmNpbEltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ3aGl0ZS1pbWFnZS1wZW5jaWxcIik7XG53aGl0ZVBlbmNpbEltYWdlLnNyYyA9IHdoaXRlUGVuY2lsU3JjO1xuXG5pbXBvcnQgcGx1c1NyYyBmcm9tIFwiLi4vaW1hZ2VzL3BsdXMuc3ZnXCI7XG5jb25zdCBwbHVzaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImltYWdlLXBsdXNcIik7XG5wbHVzaW1hZ2Uuc3JjID0gcGx1c1NyYztcblxuaW1wb3J0IGxvZ29TcmMgZnJvbSBcIi4uL2ltYWdlcy9sb2dvLnN2Z1wiO1xuY29uc3QgbG9nb0ltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbWFnZS1sb2dvXCIpO1xubG9nb0ltYWdlLnNyYyA9IGxvZ29TcmM7XG5cbi8vID09PSBBUEkgU2V0dXAgPT09XG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCJkMzZhNDQwYS05NDQ2LTQwM2MtOWJkMC0xYzcyZDA3ZDNjMTZcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG4vLyA9PT0gRE9NIEVsZW1lbnRzID09PVxuLy8gVXNlciBJbmZvXG5jb25zdCBwcm9maWxlTmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlSm9iRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5jb25zdCBwcm9maWxlSW1hZ2VDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wcm9maWxlX19hdmF0YXItY29udGFpbmVyXCJcbik7XG5cbi8vIFByb2ZpbGUgTW9kYWxcbmNvbnN0IHByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuY29uc3QgY2xvc2VQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2Nsb3NlLWJ0bi0tZWRpdC1wcm9maWxlXCJcbik7XG5jb25zdCBzdWJtaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX3N1Ym1pdC1idG4tLWVkaXQtcHJvZmlsZVwiXG4pO1xuY29uc3QgcHJvZmlsZUZvcm1FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybS0tZWRpdC1wcm9maWxlXCIpO1xuY29uc3QgbmFtZUlucHV0ID0gcHJvZmlsZUZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmFtZVwiKTtcbmNvbnN0IGpvYklucHV0ID0gcHJvZmlsZUZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVzY3JpcHRpb25cIik7XG5cbi8vIFByb2ZpbGUgQXZhdGFyIE1vZGFsXG5jb25zdCBwcm9maWxlRWRpdEltYWdlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWF2YXRhci1idG5cIik7XG5jb25zdCBwcm9maWxlRWRpdEltYWdlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWVkaXQtYXZhdGFyLW1vZGFsXCJcbik7XG5jb25zdCBwcm9maWxlRWRpdEltYWdlRm9ybUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNlZGl0LWF2YXRhci1tb2RhbFwiXG4pO1xuY29uc3QgcHJvZmlsZUltYWdlTGlua0lucHV0ID1cbiAgcHJvZmlsZUVkaXRJbWFnZUZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2UtbGlua1wiKTtcbmNvbnN0IHByb2ZpbGVJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuY29uc3QgcHJvZmlsZUltYWdlRWRpdENsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuLS1lZGl0LXByb2ZpbGUtYXZhdGFyXCIpO1xuY29uc3QgcHJvZmlsZUltYWdlU3VibWl0QnRuID0gcHJvZmlsZUVkaXRJbWFnZUZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19zdWJtaXQtYnRuLS1lZGl0LWF2YXRhci1wcm9maWxlXCJcbik7XG5cbi8vIE5ldyBQb3N0IE1vZGFsXG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgbmV3UG9zdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbmNvbnN0IG5ld1Bvc3RDbG9zZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0bi0tbmV3LXBvc3RcIik7XG5jb25zdCBuZXdQb3N0U3VibWl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0bi0tbmV3LXBvc3RcIik7XG5jb25zdCBuZXdQb3N0Rm9ybUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtLS1uZXctcG9zdFwiKTtcbmNvbnN0IGltYWdlTGlua0lucHV0ID0gbmV3UG9zdEZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2UtbGlua1wiKTtcbmNvbnN0IGNhcHRpb25JbnB1dCA9IG5ld1Bvc3RGb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiI3Bvc3QtY2FwdGlvblwiKTtcblxuLy8gRGVsZXRlIFBvc3QgTW9kYWxcbmNvbnN0IGRlbGV0ZVBvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWNhcmQtbW9kYWxcIik7XG5jb25zdCBkZWxldGVQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FyZC1kZWxldGUtYnRuXCIpO1xuY29uc3QgY2FuZWxEZWxldGVQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2NhcmQtZGVsZXRlLWNhbmNlbC1idG5cIlxuKTtcbmNvbnN0IGRlbGV0ZU1vZGFsQ2xvc2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnRuLS1kZWxldGUtY2FyZFwiXG4pO1xuXG4vLyBQcmV2aWV3IE1vZGFsXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3SW1hZ2UgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2UtLXByZXZpZXdcIik7XG5jb25zdCBwcmV2aWV3Q2FwdGlvbiA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uLS1wcmV2aWV3XCIpO1xuY29uc3QgcHJldmlld0Nsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idG4tLXByZXZpZXdcIlxuKTtcblxuLy8gQ2FyZHNcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbi8vID09PSBGZXRjaCBVc2VyIEluZm8gPT09XG5hcGlcbiAgLmdldFVzZXJJbmZvKClcbiAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICBwcm9maWxlTmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgcHJvZmlsZUpvYkVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICAgIHByb2ZpbGVJbWFnZS5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xuXG4vLyA9PT0gRmV0Y2ggYW5kIFJlbmRlciBDYXJkcyA9PT1cbmFwaVxuICAuZ2V0SW5pdGlhbENhcmRzKClcbiAgLnRoZW4oKGRhdGEpID0+IGRhdGEubWFwKChpdGVtKSA9PiBpdGVtKSlcbiAgLnRoZW4oKGNhcmRzKSA9PiB7XG4gICAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xuICAgICAgY29uc3QgbmV3Q2FyZCA9IGdldENhcmRFbGVtZW50KGNhcmQpO1xuICAgICAgY2FyZHNMaXN0LmFwcGVuZChuZXdDYXJkKTtcbiAgICB9KTtcbiAgfSlcbiAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuXG4vLyA9PT0gQ2FyZCBMb2dpYyA9PT1cbmxldCBzZWxlY3RlZENhcmQ7XG5sZXQgc2VsZWN0ZWRDYXJkSUQ7XG5cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkX190ZW1wbGF0ZVwiKS5jb250ZW50O1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIikuY2xvbmVOb2RlKHRydWUpO1xuICBjb25zdCBjYXJkVGl0bGUgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2UgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCBjYXJkTGlrZUJ0biA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XG5cbiAgY2FyZFRpdGxlLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICBjYXJkSW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xuXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gIH1cblxuICBjYXJkSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBwcmV2aWV3SW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICAgIHByZXZpZXdJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld0NhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XG4gIH0pO1xuXG4gIGNhcmRMaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY2FyZExpa2VCdG4uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnRuX2xpa2VkXCIpO1xuICAgIGhhbmRsZUNhcmRMaWtlVW5saWtlKGNhcmRMaWtlQnRuLCBkYXRhKTtcbiAgfSk7XG5cbiAgY2FyZERlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEpO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUNhcmRMaWtlVW5saWtlKGNhcmRMaWtlQnRuLCBkYXRhKSB7XG4gIHNlbGVjdGVkQ2FyZElEID0gZGF0YS5faWQ7XG4gIGlmIChjYXJkTGlrZUJ0bi5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKSkge1xuICAgIGFwaS5hZGRMaWtlKHNlbGVjdGVkQ2FyZElEKS5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xuICB9IGVsc2Uge1xuICAgIGFwaS5yZW1vdmVMaWtlKHNlbGVjdGVkQ2FyZElEKS5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEpIHtcbiAgc2VsZWN0ZWRDYXJkID0gY2FyZEVsZW1lbnQ7XG4gIHNlbGVjdGVkQ2FyZElEID0gZGF0YS5faWQ7XG4gIG9wZW5Nb2RhbChkZWxldGVQb3N0TW9kYWwpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVTdWJtaXQoKSB7XG4gIGNvbnN0IG9yaWdpbmFsVGV4dCA9IGRlbGV0ZVBvc3RCdG4udGV4dENvbnRlbnQ7XG4gIGRlbGV0ZVBvc3RCdG4udGV4dENvbnRlbnQgPSBcIkRlbGV0aW5nLi4uXCI7XG4gIGFwaVxuICAgIC5yZW1vdmVDYXJkKHNlbGVjdGVkQ2FyZElEKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlUG9zdE1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgZGVsZXRlUG9zdEJ0bi50ZXh0Q29udGVudCA9IG9yaWdpbmFsVGV4dDtcbiAgICB9KTtcbn1cblxuLy8gPT09IEV2ZW50IExpc3RlbmVycyA9PT1cbi8vIE1vZGFsIE9wZW4gRXZlbnRzXG5lZGl0UHJvZmlsZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwocHJvZmlsZU1vZGFsKTtcbiAgbmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWVFbGVtZW50LnRleHRDb250ZW50O1xuICBqb2JJbnB1dC52YWx1ZSA9IHByb2ZpbGVKb2JFbGVtZW50LnRleHRDb250ZW50O1xufSk7XG5cbm5ld1Bvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpKTtcbnByb2ZpbGVFZGl0SW1hZ2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XG4gIG9wZW5Nb2RhbChwcm9maWxlRWRpdEltYWdlTW9kYWwpXG4pO1xuXG4vLyBNb2RhbCBDbG9zZSBFdmVudHNcbmNsb3NlUHJvZmlsZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChwcm9maWxlTW9kYWwpKTtcbm5ld1Bvc3RDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpKTtcbmRlbGV0ZVBvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZURlbGV0ZVN1Ym1pdCk7XG5jYW5lbERlbGV0ZVBvc3RCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwoZGVsZXRlUG9zdE1vZGFsKSk7XG5kZWxldGVNb2RhbENsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICBjbG9zZU1vZGFsKGRlbGV0ZVBvc3RNb2RhbClcbik7XG5wcmV2aWV3Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwocHJldmlld01vZGFsKSk7XG5wcm9maWxlSW1hZ2VFZGl0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpPT4gY2xvc2VNb2RhbChwcm9maWxlRWRpdEltYWdlTW9kYWwpKTtcbi8vIFByb2ZpbGUgRm9ybSBTdWJtaXNzaW9uXG5wcm9maWxlRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdCk7XG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IG9yaWdpbmFsVGV4dCA9IHN1Ym1pdFByb2ZpbGVCdG4udGV4dENvbnRlbnQ7XG4gIHN1Ym1pdFByb2ZpbGVCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKHsgbmFtZTogbmFtZUlucHV0LnZhbHVlLCBhYm91dDogam9iSW5wdXQudmFsdWUgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgcHJvZmlsZU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgICAgcHJvZmlsZUpvYkVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLmFib3V0O1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzdWJtaXRQcm9maWxlQnRuLnRleHRDb250ZW50ID0gb3JpZ2luYWxUZXh0O1xuICAgIH0pO1xuXG4gIGNsb3NlTW9kYWwocHJvZmlsZU1vZGFsKTtcbn1cblxuLy8gTmV3IFBvc3QgU3VibWlzc2lvblxubmV3UG9zdEZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlTmV3UG9zdFN1Ym1pdCk7XG5mdW5jdGlvbiBoYW5kbGVOZXdQb3N0U3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgb3JpZ2luYWxUZXh0ID0gbmV3UG9zdFN1Ym1pdEJ0bi50ZXh0Q29udGVudDtcbiAgbmV3UG9zdFN1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gIGFwaVxuICAgIC5wb3N0Q2FyZCh7IGNhcHRpb246IGNhcHRpb25JbnB1dC52YWx1ZSwgbGluazogaW1hZ2VMaW5rSW5wdXQudmFsdWUgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY29uc3QgbmV3Q2FyZCA9IGdldENhcmRFbGVtZW50KGRhdGEpO1xuICAgICAgY2FyZHNMaXN0LnByZXBlbmQobmV3Q2FyZCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIG5ld1Bvc3RTdWJtaXRCdG4udGV4dENvbnRlbnQgPSBvcmlnaW5hbFRleHQ7XG4gICAgfSk7XG4gIGNhcHRpb25JbnB1dC52YWx1ZSA9IFwiXCI7XG4gIGltYWdlTGlua0lucHV0LnZhbHVlID0gXCJcIjtcbiAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xufVxuXG4vLyBQcm9maWxlIEF2YXRhciBTdWJtaXNzaW9uXG5wcm9maWxlRWRpdEltYWdlRm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVOZXdQcm9maWxlSW1hZ2VTdWJtaXQpO1xuXG5mdW5jdGlvbiBoYW5kbGVOZXdQcm9maWxlSW1hZ2VTdWJtaXQoZXZ0KSB7XG4gIGNvbnNvbGUubG9nKCdTdWJtaXQnKVxuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3QgbGluayA9IHByb2ZpbGVJbWFnZUxpbmtJbnB1dC52YWx1ZTtcbiAgY29uc3Qgb3JpZ2luYWxUZXh0ID0gcHJvZmlsZUltYWdlU3VibWl0QnRuLnRleHRDb250ZW50O1xuICBwcm9maWxlSW1hZ2VTdWJtaXRCdG4udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiXG4gIGFwaVxuICAuZWRpdFByb2ZpbGVBdmF0YXIobGluaylcbiAgLnRoZW4oKHVzZXJEYXRhKT0+e1xuICAgIHByb2ZpbGVJbWFnZS5zcmMgPSB1c2VyRGF0YS5hdmF0YXI7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpXG4gIC5maW5hbGx5KCgpPT57XG4gICAgcHJvZmlsZUltYWdlU3VibWl0QnRuLnRleHRDb250ZW50PSBvcmlnaW5hbFRleHQ7XG4gIH0pO1xuXG4gIGNsb3NlTW9kYWwocHJvZmlsZUVkaXRJbWFnZU1vZGFsKTtcbn1cblxuLy8gLy8gQXZhdGFyIEhvdmVyXG4vLyBwcm9maWxlSW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLCBmdW5jdGlvbiAoKSB7XG4vLyAgIHByb2ZpbGVFZGl0SW1hZ2VCdG4uc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuLy8gfSk7XG4vLyBwcm9maWxlSW1hZ2VDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsIGZ1bmN0aW9uICgpIHtcbi8vICAgcHJvZmlsZUVkaXRJbWFnZUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4vLyB9KTtcblxuLy8gTW9kYWwgSGVscGVyc1xuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XG59XG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZSk7XG59XG5cbi8vIENsb3NlIE1vZGFscyBvbiBPdmVybGF5IENsaWNrXG5jb25zdCBtb2RhbHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsXCIpO1xubW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBtb2RhbCkge1xuICAgICAgY2xvc2VNb2RhbChtb2RhbCk7XG4gICAgfVxuICB9KTtcbn0pO1xuXG4vLyBDbG9zZSBNb2RhbCBvbiBFU0NcbmZ1bmN0aW9uIGhhbmRsZUVzY2FwZShldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBvcGVuZWRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlbmVkXCIpO1xuICAgIGlmIChvcGVuZWRNb2RhbCkge1xuICAgICAgY2xvc2VNb2RhbChvcGVuZWRNb2RhbCk7XG4gICAgfVxuICB9XG59XG5cbi8vID09PSBJbml0aWFsaXplIFZhbGlkYXRpb24gPT09XG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsInRvZ2dsZUJ1dHRvblN0YXRlIiwiaW5wdXRMaXN0IiwiYnV0dG9uRWxlbWVudCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImFkZCIsInNvbWUiLCJpbnB1dEVsZW1lbnQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInNyYyIsInBlbmNpbFNyYyIsIndoaXRlUGVuY2lsU3JjIiwicGx1c1NyYyIsImxvZ29TcmMiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJ0aGlzIiwiX2Jhc2VVcmwiLCJiYXNlVXJsIiwiX2hlYWRlcnMiLCJoZWFkZXJzIiwiZWRpdFVzZXJJbmZvIiwiX3JlZiIsIm5hbWUiLCJhYm91dCIsImZldGNoIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldFVzZXJJbmZvIiwiZWRpdFByb2ZpbGVBdmF0YXIiLCJhdmF0YXIiLCJnZXRJbml0aWFsQ2FyZHMiLCJwb3N0Q2FyZCIsIl9yZWYyIiwiY2FwdGlvbiIsImxpbmsiLCJyZW1vdmVDYXJkIiwiY2FyZElkIiwiYWRkTGlrZSIsInJlbW92ZUxpa2UiLCJhdXRob3JpemF0aW9uIiwicHJvZmlsZU5hbWVFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsInByb2ZpbGVKb2JFbGVtZW50IiwicHJvZmlsZU1vZGFsIiwiZWRpdFByb2ZpbGVCdG4iLCJjbG9zZVByb2ZpbGVCdG4iLCJzdWJtaXRQcm9maWxlQnRuIiwicHJvZmlsZUZvcm1FbGVtZW50IiwibmFtZUlucHV0Iiwiam9iSW5wdXQiLCJwcm9maWxlRWRpdEltYWdlQnRuIiwicHJvZmlsZUVkaXRJbWFnZU1vZGFsIiwicHJvZmlsZUVkaXRJbWFnZUZvcm1FbGVtZW50IiwicHJvZmlsZUltYWdlTGlua0lucHV0IiwicHJvZmlsZUltYWdlIiwicHJvZmlsZUltYWdlRWRpdENsb3NlQnRuIiwicHJvZmlsZUltYWdlU3VibWl0QnRuIiwibmV3UG9zdE1vZGFsIiwibmV3UG9zdEJ0biIsIm5ld1Bvc3RDbG9zZUJ0biIsIm5ld1Bvc3RTdWJtaXRCdG4iLCJuZXdQb3N0Rm9ybUVsZW1lbnQiLCJpbWFnZUxpbmtJbnB1dCIsImNhcHRpb25JbnB1dCIsImRlbGV0ZVBvc3RNb2RhbCIsImRlbGV0ZVBvc3RCdG4iLCJjYW5lbERlbGV0ZVBvc3RCdG4iLCJkZWxldGVNb2RhbENsb3NlQnRuIiwicHJldmlld01vZGFsIiwicHJldmlld0ltYWdlIiwicHJldmlld0NhcHRpb24iLCJwcmV2aWV3Q2xvc2VCdG4iLCJjYXJkc0xpc3QiLCJzZWxlY3RlZENhcmQiLCJzZWxlY3RlZENhcmRJRCIsImdldENhcmRFbGVtZW50IiwiZGF0YSIsImNhcmRFbGVtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmRUaXRsZSIsImNhcmRJbWFnZSIsImNhcmRMaWtlQnRuIiwiY2FyZERlbGV0ZUJ0biIsInRleHRDb250ZW50IiwiYWx0IiwiaXNMaWtlZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJvcGVuTW9kYWwiLCJ0b2dnbGUiLCJfaWQiLCJjb250YWlucyIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwiaGFuZGxlQ2FyZExpa2VVbmxpa2UiLCJoYW5kbGVEZWxldGVDYXJkIiwibW9kYWwiLCJoYW5kbGVFc2NhcGUiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleSIsIm9wZW5lZE1vZGFsIiwibWFwIiwiaXRlbSIsImNhcmRzIiwiZm9yRWFjaCIsImNhcmQiLCJuZXdDYXJkIiwiYXBwZW5kIiwidmFsdWUiLCJvcmlnaW5hbFRleHQiLCJmaW5hbGx5IiwicHJldmVudERlZmF1bHQiLCJwcmVwZW5kIiwibG9nIiwidXNlckRhdGEiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZXZlbnQiLCJ0YXJnZXQiLCJBcnJheSIsImZyb20iLCJmb3JtRWxlbWVudCIsInNldEV2ZW50TGlzdGVuZXJzIiwiY2hlY2tJbnB1dFZhbGlkaXR5IiwiaGlkZUlucHV0RXJyb3IiLCJlcnJvckVsZW1lbnQiLCJpZCIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJlbmFibGVWYWxpZGF0aW9uIl0sInNvdXJjZVJvb3QiOiIifQ==